---
import i18next from "i18next";

function getLangName(lang) {
  switch (lang) {
    case "en":
      return "English";
    case "es":
      return "Español";
    case "ca":
      return "Català";
    default:
      break;
  }
}

function removeLangFromRoute(route) {
  const segments = route.split("/");
  if (i18next.languages.includes(segments[1])) {
    segments.splice(1, 1);
  }
  return segments.join("/");
}

const currentRoute = removeLangFromRoute(Astro.url.pathname);
---

<button
  onclick="toggleLangDropdown()"
  class="w-8 h-8 inline-block relative"
  ><img src={`/img/emoji/${i18next.language}.png`} class="w-8" /></button
>
<ul id="langDropdown" class="right-20 top-20 z-50 absolute hidden">
  {
    i18next.languages
      .filter((lang) => lang !== i18next.language)
      .map((lang) => (
        <li class="mr-2 mb-3 transition-all" style="opacity:0; transform:translate(0, -20px);" key={lang}>
          <a
            href={`${lang === "en" ? "" : "/" + lang}${currentRoute}`}
            class="text-white flex flex-row items-center justify-end gap-3"
          >
            <p>{getLangName(lang)}</p>
            <img src={`/img/emoji/${lang}.png`} class="w-7" />
          </a>
        </li>
      ))
  }
</ul>

<script is:inline data-astro-rerun>
    function toggleLangDropdown() {
      const dropdown = document.getElementById("langDropdown");
      const links = dropdown.querySelectorAll("li");

      if (dropdown.classList.contains("hidden")) {
        dropdown.classList.remove("hidden");
        dropdown.classList.remove("pointer-events-none");

        links.forEach((link, index) => {
          setTimeout(() => {
            link.style.opacity = "1";
            link.style.transform = "translateY(0)";
          }, index * 100);
        });
      } else {
        links.forEach((link, index) => {
          setTimeout(() => {
            link.style.opacity = "0";
            link.style.transform = "translateY(-20px)";
          }, index * 100);
        });

        setTimeout(() => {
          dropdown.classList.add("hidden");
          dropdown.classList.add("pointer-events-none");
        }, links.length * 100);
      }
    }
  </script>

<style>
  a:hover p {
    transform: translate(0px, 0);
    opacity: 1;
    transition: 0.2s;
  }
  a:hover img {
    opacity: 1;
    transition: opacity 0.2s;
  }
  a img {
    opacity: 0.8;
  }
  a p {
    transform: translate(20px, 0);
    opacity: 0;
    transition: 0.2s;
  }
</style>
