---
import i18next, { t } from "i18next";
import { localizePath } from "astro-i18next";
import HeaderLink from "./HeaderLink.astro";
import LanguageDropdown from "./LanguageDropdown.astro";

const { isIndex, isWork } = Astro.props;
---

<header
  class="p-8 sm:px-12 w-full h-20 z-50 fixed transition-transform transition-timing-function: cubic-bezier(0, 0, 0, 1);"
  id="header"
>
  <nav class="flex flex-row items-center justify-between gap-5">
    <div class="flex flex-row items-center gap-6">
      <h2>
        <a href={localizePath("/")}
          ><img src="/img/am.svg" alt="Go home" width="70px" /></a
        >
      </h2>
    </div>
    <div
      class={`flex-row items-center gap-6 internal-links sm:flex transition-all hidden`}
    >
      <div
        class="mr-6 flex-row items-center gap-9 internal-links sm:flex hidden"
      >
        <HeaderLink href={localizePath("/about")}
          >{t("header.about")}</HeaderLink
        >
        <HeaderLink href={localizePath("/work")}>{t("header.work")}</HeaderLink>
        <HeaderLink href={localizePath("/#contact")}
          >{t("header.contact")}</HeaderLink
        >
      </div>
      <LanguageDropdown />
      <button class="btn" id="menuIcon" onclick="toggleDropdown();">
        <img
          src="https://unpkg.com/pixelarticons@1.8.1/svg/chevron-down.svg"
          alt="Socials"
          class="invert w-8 h-8 opacity-60 hover:opacity-100 transition-all"
        />
      </button>
      <div
        id="dropdown"
        class="top-20 right-12 dropdown-content hidden pointer-events-none mt-0 p-1 flex flex-col items-end gap-3 z-10 transition-all absolute"
      >
        <a
          href="https://x.com/alexmalvehy"
          class="flex flex-row gap-3 items-center justify-end opacity-0 transition-all"
        >
          <div class="h-10 flex flex-col items-end justify-center gap-0">
            <p class="p-0 m-0 leading-tight">Twitter</p>
          </div>
          <img
            src="/img/SVG_socials/twitter.svg"
            alt="Twitter logo"
            class="h-6 invert hover:opacity-100 opacity-30 transition-all"
          /></a
        >
        <a
          href="https://www.behance.net/alexmalvehy"
          class="flex flex-row gap-3 items-center justify-end opacity-0 transition-all"
        >
          <div class="h-10 flex flex-col items-end justify-center gap-0">
            <p class="p-0 m-0 leading-tight">Behance</p>
          </div>
          <img
            src="/img/SVG_socials/behance.svg"
            alt="Behance logo"
            class="h-6 invert hover:opacity-100 opacity-30 transition-all"
          /></a
        >
        <a
          href="https://www.youtube.com/c/Al3xitu"
          class="flex flex-row gap-3 items-center justify-end opacity-0 transition-all"
        >
          <div class="h-10 flex flex-col items-end justify-center gap-0">
            <p class="p-0 m-0 leading-tight">YouTube</p>
          </div>
          <img
            src="/img/SVG_socials/youtube.svg"
            alt="YouTube logo"
            class="h-6 invert hover:opacity-100 opacity-30 transition-all"
          /></a
        >
        <a
          href="https://www.instagram.com/alexmalvehy/"
          class="flex flex-row gap-3 items-center justify-end opacity-0 transition-all"
        >
          <div class="h-10 flex flex-col items-end justify-center gap-0">
            <p class="p-0 m-0 leading-tight">Instagram</p>
          </div>
          <img
            src="/img/SVG_socials/instagram.svg"
            alt="Instagram logo"
            class="h-6 invert hover:opacity-100 opacity-30 transition-all"
          /></a
        >
        <a
          href="https://www.linkedin.com/company/alexmalvehy/"
          class="flex flex-row gap-3 items-center justify-end opacity-0 transition-all"
        >
          <div class="h-10 flex flex-col items-end justify-center gap-0">
            <p class="p-0 m-0 leading-tight">LinkedIn</p>
          </div>
          <img
            src="/img/SVG_socials/linkedin.svg"
            alt="LinkedIn logo"
            class="h-6 invert hover:opacity-100 opacity-30 transition-all"
          /></a
        >
      </div>
    </div>
    <div class="sm:hidden flex items-center">
      <button class="btn" id="hamburgerMenu" onclick="toggleMobileMenu();">
        <img
          src="https://unpkg.com/pixelarticons@1.8.1/svg/menu.svg"
          alt="Menu"
          class="invert w-8 h-8 opacity-60 hover:opacity-100 transition-all"
        />
      </button>
    </div>
  </nav>
</header>

<div
  id="mobileMenu"
  class="opacity w-screen h-screen inset-0 bg-black bg-opacity-90 z-50 hidden flex flex-col items-center justify-between fixed"
>
  <div
    class="animate-slide top-0 left-0 w-[calc(100vw-67px)] m-8 mt-9 flex flex-col items-end justify-between gap-6 relative"
  >
    <button
      id="closebtn"
      class="btn"
      style="transition: 0.3s cubic-bezier(0, 0, 0, 1);"
      onclick="toggleMobileMenu();"
    >
      <img
        src="https://unpkg.com/pixelarticons@1.8.1/svg/close.svg"
        alt="Close"
        class="invert w-8 h-8 opacity-60 hover:opacity-100 transition-all"
      />
    </button>
    <span
      style="opacity:0; animation: fadeslide 0.3s 0ms cubic-bezier(0, 0, 0, 1) forwards;"
    >
      <HeaderLink href={localizePath("/about")}>{t("header.about")}</HeaderLink>
    </span>
    <span
      style="opacity:0; animation: fadeslide 0.3s 200ms cubic-bezier(0, 0, 0, 1) forwards;"
    >
      <HeaderLink href={localizePath("/work")}>{t("header.work")}</HeaderLink>
    </span>
    <span
      style="opacity:0; animation: fadeslide 0.3s 400ms cubic-bezier(0, 0, 0, 1) forwards;"
    >
      <HeaderLink href={localizePath("/#contact")}
        >{t("header.contact")}</HeaderLink
      >
    </span>
    <span
      style="opacity:0; animation: fadeslide 0.3s 600ms cubic-bezier(0, 0, 0, 1) forwards;"
    >
      <LanguageDropdown isMobile />
    </span>
  </div>
  <div
    class="w-[calc(100vw-67px)] m-8 flex flex-row items-center justify-between gap-6 relative"
  >
    <a
      href="https://x.com/alexmalvehy"
      class="opacity-0 transition-all fade-in2"
      style="animation-delay: 0s"
    >
      <img
        src="/img/SVG_socials/twitter.svg"
        alt="Twitter logo"
        class="h-6 invert"
      />
    </a>
    <a
      href="https://www.behance.net/alexmalvehy"
      class="opacity-0 transition-all fade-in2"
      style="animation-delay: 0.1s"
    >
      <img
        src="/img/SVG_socials/behance.svg"
        alt="Behance logo"
        class="h-6 invert"
      />
    </a>
    <a
      href="https://www.youtube.com/c/Al3xitu"
      class="opacity-0 transition-all fade-in2"
      style="animation-delay: 0.2s"
    >
      <img
        src="/img/SVG_socials/youtube.svg"
        alt="YouTube logo"
        class="h-6 invert"
      />
    </a>
    <a
      href="https://www.instagram.com/alexmalvehy/"
      class="opacity-0 transition-all fade-in2"
      style="animation-delay: 0.3s"
    >
      <img
        src="/img/SVG_socials/instagram.svg"
        alt="Instagram logo"
        class="h-6 invert"
      />
    </a>
    <a
      href="https://www.linkedin.com/company/alexmalvehy/"
      class="opacity-0 transition-all fade-in2"
      style="animation-delay: 0.4s"
    >
      <img
        src="/img/SVG_socials/linkedin.svg"
        alt="LinkedIn logo"
        class="h-6 invert"
      />
    </a>
  </div>
</div>

<script is:inline>
  function toggleMobileMenu() {
    if (mobileMenu.classList.contains("hidden")) {
      document.getElementById("closebtn").style.transform = "rotate(0deg)";
      mobileMenu.classList.remove("fadeout");
      mobileMenu.classList.toggle("hidden");
    } else {
      document.getElementById("closebtn").style.transform = "rotate(90deg)";
      mobileMenu.classList.add("fadeout");
      setTimeout(() => {
        mobileMenu.classList.toggle("hidden");
      }, 200);
    }
  }

  function toggleDropdown() {
    const dropdown = document.getElementById("dropdown");
    const links = dropdown.querySelectorAll("a");
    const menuIcon = document.getElementById("menuIcon");

    if (dropdown.classList.contains("hidden")) {
      dropdown.classList.remove("hidden");
      dropdown.classList.remove("pointer-events-none");
      menuIcon.style.transform = "rotate(90deg)";

      links.forEach((link, index) => {
        setTimeout(() => {
          link.style.opacity = "1";
          link.style.transform = "translateY(0)";
        }, index * 100);
      });
    } else {
      links.forEach((link, index) => {
        setTimeout(() => {
          link.style.opacity = "0";
          link.style.transform = "translateY(-20px)";
        }, index * 100);
      });

      setTimeout(() => {
        dropdown.classList.add("hidden");
        dropdown.classList.add("pointer-events-none");
        menuIcon.style.transform = "rotate(0deg)";
      }, links.length * 100);
    }
  }
</script>

<script define:vars={{ isIndex, isWork }} data-astro-rerun>
  const header = document.getElementById("header");
  const mobileMenu = document.getElementById("mobileMenu");

  if (isIndex) {
    header.classList.add("-translate-y-20");
    window.addEventListener("scroll", () => {
      if (window.scrollY > 100) {
        header.classList.remove("-translate-y-20");
      } else {
        header.classList.add("-translate-y-20");
      }
    });
  } else {
    header.classList.remove("-translate-y-20");
  }

  if (isWork) {
    header.style.background = "transparent";
    window.addEventListener("scroll", () => {
      if (window.scrollY > 100) {
        header.classList.add("with-before");
      } else {
        header.classList.remove("with-before");
      }
    });
  } else {
    header.classList.add("with-before");
  }
</script>

<style>
  header.with-before::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      180deg,
      rgba(0, 0, 0, 1) 0%,
      rgba(0, 0, 0, 0.6) 50%,
      rgba(0, 0, 0, 0) 100%
    );
    filter: blur(4px);
    transform: scale(150%);
    pointer-events: none;
    z-index: -1;
    opacity: 1;
    transition: opacity 0.5s ease-in-out;
  }

  header:not(.with-before)::before {
    opacity: 0;
  }

  a:hover div {
    transform: translate(0px, 0);
    opacity: 1;
    transition: 0.2s;
  }
  a:hover img {
    opacity: 1;
    transition: opacity 0.2s;
  }
  a div {
    transform: translate(20px, 0);
    opacity: 0;
    transition: 0.2s;
  }
  #dropdown {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
  }
  #dropdown a {
    opacity: 0;
    transform: translateY(-20px);
  }
  #dropdown.show a {
    opacity: 1;
    transform: translateY(0);
  }
  .animate-slide button {
    animation: rotatefade 0.3s cubic-bezier(0, 0, 0, 1);
    animation-delay: 0s;
  }
  @keyframes rotatefade {
    0% {
      opacity: 0;
      transform: rotate(90deg);
    }
    100% {
      opacity: 1;
      transform: rotate(0deg);
    }
  }
  @keyframes fadeslide {
    0% {
      opacity: 0;
      transform: translate(20px, 0);
    }
    100% {
      opacity: 1;
      transform: translate(0px, 0);
    }
  }
  .opacity {
    animation: fadein 0.3s cubic-bezier(0, 0, 0, 1);
  }
  @keyframes fadein {
    0% {
      opacity: 0;
    }
    100% {
      opacity: 1;
    }
  }
  .fade-in2 {
    animation: fadeIn2 0.5s cubic-bezier(0, 0, 0, 1) forwards;
    transition: 0.2s;
  }
  .fade-in2:hover {
    opacity: 1 !important;
    transition: 0.2s;
  }
  @keyframes fadeIn2 {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 0.6;
      transform: translateY(0);
    }
  }
  .fadeout {
    animation: fadeout 0.2 forwards;
  }
  @keyframes fadeout {
    0% {
      opacity: 1;
    }
    100% {
      opacity: 0;
    }
  }
  .animatein {
    animation: auto linear animatein both;
    animation-timeline: view();
    animation-range: exit;
  }
  @keyframes animatein {
    0% {
      opacity: 0;
      transform: translateY(20px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
